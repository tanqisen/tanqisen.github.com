<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Android | Cooper's Blog]]></title>
  <link href="http://tanqisen.github.com/blog/categories/android/atom.xml" rel="self"/>
  <link href="http://tanqisen.github.com/"/>
  <updated>2015-06-30T17:28:42+08:00</updated>
  <id>http://tanqisen.github.com/</id>
  <author>
    <name><![CDATA[tanqisen]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[一步一步实现Android打飞机（二）]]></title>
    <link href="http://tanqisen.github.com/blog/2013/09/13/develop-android-wechat-flight-game-step-by-step-2/"/>
    <updated>2013-09-13T18:31:00+08:00</updated>
    <id>http://tanqisen.github.com/blog/2013/09/13/develop-android-wechat-flight-game-step-by-step-2</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/tanqisen/Flight">Android打飞机源码</a></p>

<h3>六、角色和状态接口设计</h3>

<p>角色基本属性有最大生命值、当前生命值、速度、攻击力、角色位置、角色状态等。角色行为有移动、显示、检测是否与别的角色碰撞、被攻击等。状态属于角色内部属性，可将状态设计成内部类的形式，在特定状态下，角色有特定的行为。例如，正常状态下敌机匀速向屏幕底部移动，受伤后敌机会加速移动，爆炸时敌机原地爆炸、不能移动。</p>

<blockquote><p>注意：我这里说的接口并不是java语言的接口，为了方便实现，使用了普通java类。另外属性权限访问也没有严格限制，还需要改进。</p></blockquote>

<!--more-->


<p><div><script src='https://gist.github.com/6608198.js?file=Art.java'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>

<p>详细解释一下：</p>

<ol>
<li><code>ArtFactory</code>角色工厂，管理角色的创建和回收等；</li>
<li><code>GameContext</code>游戏环境，主要完成贴图的工作，让角色本身不用再关心如何贴图，角色只要设置好当前要绘制的精灵名<code>sprite</code>，GameContext自动根据精灵名称、角色位置显示当前角色；</li>
<li><code>reset</code>函数用来初始化角色的所有属性，用于被角色工厂重用；</li>
<li>在<code>move</code>和<code>draw</code>函数中传入的参数<code>float deltaTime</code>表示上一帧到当前帧所用的时间间隔，这个时间用来计算角色当前要偏移的距离(speed * deltaTime)，以及动画持续时间控制，如爆炸效果的一组图片轮播时，每个图片显示0.1秒，就需要用这个参数控制；总之，这个参数目的是消除不同帧率的设备上移动、动画等速度不一致的问题。</li>
<li>这里的碰撞检测只是简单的矩形碰撞，有时看起来不是很真实，特别是飞机的两个角发生碰撞时。如果希望准确的碰撞检测可以在检测到矩形相交后，进一步检测相交区域的像素是否碰撞；</li>
</ol>


<blockquote><p>碰撞检测时会遇到一个问题是，如果在大分辨率的手机上运行游戏，因为子弹、飞机等的图片很小，如果子弹速度很快，会出现子弹击穿飞机现象。其实这并不是碰撞检测出了问题，而是子弹速度过快导致上一帧子弹距离飞机还有一段距离，但接下来的一帧，由于速度太大导致偏移的距离(speed * deltaTime)直接越过了飞机，显示在了飞机后面，视觉上感觉子弹从飞机身体里穿越过去了。处理这个问题的办法是，子弹的速度不要的过大，同时可以使用使用大点的飞机图片。</p>

<p>另外：由于没注意看文档，踩到了Rect的一个坑。Rect.intersects(r1, r2); 和r1.intersect(r2)居然有不一样的行为，你敢信？</p></blockquote>

<h3>七、使用Art和ArtState接口实现小型敌机</h3>

<p><div><script src='https://gist.github.com/6608198.js?file=Enemy1.java'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>

<p>可以看出小飞机的实现过程非常简单，只需要设置小飞机的各项属性，以及实现小飞机可能处于的状态类，同时为不同状态实现不同行为就可以了。小飞机没有被攻击被攻击的状态，就不用实现相应状态类。同样地方法可实现英雄、中型飞机、敌机、子弹等角色，这里不再详细列举。</p>

<h3>八、角色工厂</h3>

<p>角色工厂的目标是按一定的时间间隔创建新角色和回收利用被销毁的角色。提供的接口有：
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>角色工厂  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// 构造函数</span>
</span><span class='line'><span class="c1">// 基于一定的时间间隔(tick)和随机因素(salt)创建一个cls实例</span>
</span><span class='line'><span class="kd">public</span> <span class="nf">ArtFactory</span><span class="o">(</span><span class="n">Class</span><span class="o">&amp;</span><span class="n">lt</span><span class="o">;?&gt;</span> <span class="n">cls</span><span class="o">,</span> <span class="kt">float</span> <span class="n">tick</span><span class="o">,</span> <span class="kt">int</span> <span class="n">salt</span><span class="o">);&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// 按时间间隔随机生成新角色，如果生成成功返回实例，失败返回null</span>
</span><span class='line'><span class="kd">public</span> <span class="n">Art</span> <span class="nf">genareteArt</span><span class="o">(</span><span class="n">GameContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="kt">float</span> <span class="n">deltaTime</span><span class="o">);&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// 重复利用角色a</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">reuseArt</span><span class="o">(</span><span class="n">Art</span> <span class="n">a</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>九、武器实现</h3>

<p>英雄可以拥有不同武器，武器可以发射子弹。武器我们可以抽象成</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>武器接口  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IWeapon</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// 开火</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Art</span> <span class="nf">fire</span><span class="o">(</span><span class="kt">float</span> <span class="n">deltaTime</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>实现一个具体武器：</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>具体武器实现  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Weapon</span> <span class="kd">implements</span> <span class="n">IWeapon</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// 武器持有者</span>
</span><span class='line'>  <span class="n">Art</span> <span class="n">hero</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="c1">// 子弹工厂，不同的子弹工厂就可以发射不同的子弹</span>
</span><span class='line'>  <span class="n">ArtFactory</span> <span class="n">bulletFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="kd">public</span> <span class="n">Weapon</span><span class="o">(</span><span class="n">Art</span> <span class="n">hero</span><span class="o">,</span> <span class="n">ArtFactory</span> <span class="n">bulletFactory</span><span class="o">)</span> <span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">this</span><span class="o">.</span><span class="na">hero</span> <span class="o">=</span> <span class="n">hero</span><span class="o">;</span>
</span><span class='line'><span class="k">this</span><span class="o">.</span><span class="na">bulletFactory</span> <span class="o">=</span> <span class="n">bulletFactory</span><span class="o">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Art</span> <span class="nf">fire</span><span class="o">(</span><span class="kt">float</span> <span class="n">deltaTime</span><span class="o">)</span> <span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="c1">// 发射子弹</span>
</span><span class='line'><span class="k">if</span> <span class="o">(</span><span class="n">bulletFactory</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Art</span> <span class="n">b</span> <span class="o">=</span> <span class="n">bulletFactory</span><span class="o">.</span><span class="na">genareteArt</span><span class="o">(</span><span class="n">hero</span><span class="o">.</span><span class="na">gameContext</span><span class="o">,</span> <span class="n">deltaTime</span><span class="o">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="n">b</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// 工厂生成新子弹后，根据武器持有者当前位置，调整发射子弹的初始位置</span>
</span><span class='line'>    <span class="n">b</span><span class="o">.</span><span class="na">spriteFrame</span><span class="o">.</span><span class="na">offset</span><span class="o">(</span><span class="n">hero</span><span class="o">.</span><span class="na">spriteFrame</span><span class="o">.</span><span class="na">left</span><span class="o">+(</span><span class="n">hero</span><span class="o">.</span><span class="na">spriteFrame</span><span class="o">.</span><span class="na">width</span><span class="o">()</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="na">spriteFrame</span><span class="o">.</span><span class="na">width</span><span class="o">())/</span><span class="mi">2</span><span class="o">,</span> <span class="n">hero</span><span class="o">.</span><span class="na">spriteFrame</span><span class="o">.</span><span class="na">top</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="na">spriteFrame</span><span class="o">.</span><span class="na">top</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">b</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>十、尾声</h3>

<p>其他一些基础类如Sprite、SpriteManager、以及GameContext如何绘制精灵、滚动背景如何绘制等细节问题不展开讨论了。基本的组件都创建好了，我们只要实现GameController来使用这些组件、加上一定的游戏逻辑就基本完成了，当然这只是一个游戏的原型，还有很多地方不够完善，这只是对Android开发的初次尝试，希望完成这个游戏的过程中的分析方法、程序设计方法、碰到的问题等可以给大家一些启发。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[一步一步实现Android打飞机（一）]]></title>
    <link href="http://tanqisen.github.com/blog/2013/09/13/develop-android-wechat-flight-game-step-by-step-1/"/>
    <updated>2013-09-13T18:31:00+08:00</updated>
    <id>http://tanqisen.github.com/blog/2013/09/13/develop-android-wechat-flight-game-step-by-step-1</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/tanqisen/Flight">Android打飞机源码</a></p>

<h3>一、概述</h3>

<p>  对没有Android开发经验，或对JAVA语言不是太熟悉的同学，希望尝试Android开发应该如何进入呢？为了避免枯燥地看教程、阅读官方sample，学习一大堆不知道什么时候会用上的API，我选择打飞机这个游戏作为切入点。一是因为开发简单游戏并不会涉及过多的平台API以及平台特性，只需要知道基本的贴图、多线程、用户交互等接口就足够了；二是可以把更多的精力放到熟悉语言、培养语感，当然还有游戏本身的逻辑，以及程序设计的通用模式；三是自己动手开发更有趣味性，所以开发中并没有使用游戏框架如cocos2d-x等，仅仅使用了一些Android原始API，毕竟只是为了学习。</p>

<h3>二、游戏框架</h3>

<p>  这是一个典型的贴图游戏，没有复杂的图形变换、动画效果等，你看到的所有效果都是不断移动、替换图片实现的，比如飞机的爆炸效果，就是连续显示几张不同的图片实现的。为了不影响用户交互，比如控制飞机移动，贴图和逻辑控制的工作应该放到一个新的线程中。Android提供了<code>SurfaceView</code>类来处理贴图的问题，让<code>SurfaceView</code>实现<code>Runnable</code>接口并配合<code>Thread</code>可以解决在子线程中贴图以及逻辑控制的问题。</p>

<!--more-->


<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>创建游戏循环  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FlightSurfaceView</span> <span class="kd">extends</span> <span class="n">SurfaceView</span> <span class="kd">implements</span> <span class="n">Callback</span><span class="o">,</span> <span class="n">Runnable</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">Thread</span> <span class="n">th</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">SurfaceHolder</span> <span class="n">sfh</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="kd">public</span> <span class="n">FlightSurfaceView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span><span class='line'><span class="k">this</span><span class="o">.</span><span class="na">setKeepScreenOn</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'><span class="n">sfh</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getHolder</span><span class="o">();</span>
</span><span class='line'><span class="n">sfh</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">setFocusable</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="kd">public</span> <span class="kt">void</span> <span class="n">surfaceCreated</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="c1">// 开始游戏循环</span>
</span><span class='line'><span class="n">th</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="c1">// 主线程事件处理</span>
</span><span class='line'><span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="c1">// 游戏线程，游戏循环</span>
</span><span class='line'><span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// 游戏逻辑控制</span>
</span><span class='line'>    <span class="n">updateFrame</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 渲染当前帧</span>
</span><span class='line'>    <span class="n">renderFrame</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 休眠当前线程，线程切换</span>
</span><span class='line'>    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">30</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceChanged</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">holder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">format</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceDestroyed</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="kd">private</span> <span class="kt">void</span> <span class="n">updateFrame</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="kd">private</span> <span class="kt">void</span> <span class="n">renderFrame</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>这样，一个基本的游戏循环就建立起来了。但这只是一个什么都不做的空循环，我们还得再这里处理游戏逻辑，以及渲染当前帧。我们先看如何渲染图片、文字。</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>绘图过程  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">renderFrame</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Canvas</span> <span class="n">canvas</span> <span class="o">=</span> <span class="n">sfh</span><span class="o">.</span><span class="na">lockCanvas</span><span class="o">();</span> <span class="c1">// 获取并锁定canvas</span>
</span><span class='line'>  <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>    <span class="c1">// 保存当前绘图环境&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="c1">// TODO 具体绘制&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span> <span class="c1">// 恢复先前绘图环境</span>
</span><span class='line'>  <span class="n">sfh</span><span class="o">.</span><span class="na">unlockCanvasAndPost</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span> <span class="c1">// 解锁canvas并绘制</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>具体绘制时，我们还需要一个绘图工具<code>Paint</code>来设置绘制的颜色、字体、样式等参数。</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>创建 Paint 绘图及游戏简单控制  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="n">Paint</span> <span class="n">paint</span><span class="o">;</span>
</span><span class='line'><span class="kd">private</span> <span class="n">Paint</span> <span class="n">textPaint</span><span class="o">;</span>
</span><span class='line'><span class="kd">private</span> <span class="n">Bitmap</span> <span class="n">bmp</span><span class="o">;</span>
</span><span class='line'><span class="kd">private</span> <span class="kt">int</span> <span class="n">x</span><span class="o">;</span>
</span><span class='line'><span class="kd">private</span> <span class="kt">int</span> <span class="n">y</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kd">public</span> <span class="n">FlightSurfaceView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">setKeepScreenOn</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>  <span class="n">sfh</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getHolder</span><span class="o">();</span>
</span><span class='line'>  <span class="n">sfh</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">this</span><span class="o">);&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">paint</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Paint</span><span class="o">();</span>
</span><span class='line'>  <span class="n">paint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">WHITE</span><span class="o">);</span>   <span class="c1">// 设置颜色为白色&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">textPaint</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Paint</span><span class="o">();</span>
</span><span class='line'>  <span class="n">textPaint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span> <span class="c1">// 设置红色文字画笔&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">bmp</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">res</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">hero</span><span class="o">);&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">x</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>
</span><span class='line'>  <span class="n">y</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">setFocusable</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'><span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// 简单的游戏控制，这里每帧向右下移动一次图片</span>
</span><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">updateFrame</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">x</span> <span class="o">++;</span>
</span><span class='line'>  <span class="n">y</span> <span class="o">++;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span> <span class="o">(</span><span class="n">x</span><span class="o">&gt;</span><span class="mi">320</span><span class="o">)</span> <span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span> <span class="o">(</span><span class="n">y</span><span class="o">&gt;</span><span class="mi">480</span><span class="o">)</span> <span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">}</span>
</span><span class='line'><span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kd">private</span> <span class="kt">void</span> <span class="n">renderFrame</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Canvas</span> <span class="n">canvas</span> <span class="o">=</span> <span class="n">sfh</span><span class="o">.</span><span class="na">lockCanvas</span><span class="o">();</span> <span class="c1">// 获取并锁定canvas</span>
</span><span class='line'>  <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>    <span class="c1">// 保存当前绘图环境&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="c1">// 绘制白色背景</span>
</span><span class='line'>  <span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">320</span><span class="o">,</span><span class="mi">480</span><span class="o">,</span><span class="n">paint</span><span class="o">);&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="c1">// 绘制文字</span>
</span><span class='line'>  <span class="n">canvas</span><span class="o">.</span><span class="na">drawText</span><span class="o">(</span><span class="s">&quot;Flight&quot;</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">textPaint</span><span class="o">);&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="c1">// 绘制图片</span>
</span><span class='line'>  <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">bmp</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">paint</span><span class="o">);&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="c1">// 绘制文字</span>
</span><span class='line'>  <span class="n">canvas</span><span class="o">.</span><span class="na">drawText</span><span class="o">(</span><span class="s">&quot;Flight&quot;</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">paint</span><span class="o">);&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span> <span class="c1">// 恢复先前绘图环境</span>
</span><span class='line'>  <span class="n">sfh</span><span class="o">.</span><span class="na">unlockCanvasAndPost</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span> <span class="c1">// 解锁canvas并绘制</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>关于Android图形API这里就不详细解释了，后面的内容才是重点。</p>

<h3>三、游戏资源</h3>

<p>游戏中用到的图片、声音等资源可以直接从微信中抠出。这里我使用的是微信iOS版的资源。解开微信安装包，找到了<code>gameArts-hd.png</code>、<code>gameArts-hd.plist</code>、<code>gameArts.png</code>、<code>gameArts.plist</code>两套图片资源，<code>hd</code>是针对高分辨率的一套图，这里我只用了普通的分辨率<code>320x480</code>的资源，一共有两个文件，一个是图片<code>gameArts.png</code>，里面包含所有的精灵贴图，以及爆炸效果等，如图所示：</p>

<p><img src="/images/gamearts.png" width="256" height="512" title="gameArts.png" ></p>

<blockquote><p>gameArts.png图片加载的是需要注意一点是使用<code>Bitmap bmp = BitmapFactory.decodeResource(res, R.raw.gamearts);</code>加载后图片由于Android系统优化，可能改变图片原来的分辨率，导致贴图的时候坐标偏移不对，这里最好使用<code>InputStream is = this.getResources().openRawResource(R.raw.gamearts); bmp = BitmapFactory.decodeStream(is);</code>来加载图片</p></blockquote>

<p>另一个文件是<code>gameArts.plist</code>，里面记录了每个精灵在<code>gameArts.png</code>中的位置以及尺寸等信息。截取gameArts.plist文件的一个片段，解释一下字段含义：</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>gameArts.plist 片段  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="s2">&quot;hero_fly_1.png&quot;</span><span class="err">:</span><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;textureRect&quot;</span><span class="p">:</span><span class="s2">&quot;{ {432, 0}, {66, 82} }&quot;</span><span class="p">,</span>   <span class="err">//</span> <span class="err">精灵在图片文件中的位置、大小</span>
</span><span class='line'>  <span class="nt">&quot;spriteSize&quot;</span><span class="p">:</span><span class="s2">&quot;{66, 82}&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;spriteColorRect&quot;</span><span class="p">:</span><span class="s2">&quot;{ {1, 1}, {66, 82} }&quot;</span><span class="p">,</span> <span class="err">//</span> <span class="err">精灵有效像素的偏移及大小</span>
</span><span class='line'>  <span class="nt">&quot;spriteTrimmed&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;aliases&quot;</span><span class="p">:[],</span>
</span><span class='line'>  <span class="nt">&quot;spriteOffset&quot;</span><span class="p">:</span><span class="s2">&quot;{0, -0}&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;textureRotated&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span> <span class="err">//</span> <span class="err">是否旋转</span>
</span><span class='line'>  <span class="nt">&quot;spriteSourceSize&quot;</span><span class="p">:</span><span class="s2">&quot;{68, 84}&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>这些字段中主要使用了<code>textureRect</code>和<code>spriteColorRect</code>，由于这套图片中的精灵都没有被旋转，所以<code>textureRotated</code>这里不需要。另外由于plist格式在Android中没原生支持，为了解析方便使用的时候将gameArts.plist转成了json格式。</p>

<blockquote><p>可能Android的apk包中的资源跟iOS格式不一样，不过大同小异，只是对文件的解析过程不一样，不影响游戏本身逻辑。可以尝试对不同分辨率载入不同资源。</p></blockquote>

<h3>四、 游戏分析</h3>

<p>先看游戏中的元素，有随机生产的敌机、玩家控制的英雄飞机、发射的子弹、掉落的降落伞等。</p>

<ul>
<li>英雄：

<ol>
<li>正常情况下，玩家可以控制其在屏幕范围内任意移动；</li>
<li>同时英雄会以一定频率自动发射子弹；</li>
<li>英雄可以持有不同种类的武器；</li>
<li>英雄在与敌机碰撞之后会爆炸，爆炸后会闪烁几次，然后游戏结束；</li>
</ol>
</li>
<li>敌机：

<ol>
<li>敌机有小型飞机、中型飞机、大型飞机；</li>
<li>小飞机再中弹后即刻爆炸；</li>
<li>中型飞机和大型飞机在受到一定次数攻击后会有预示将要爆炸的闪烁效果；</li>
<li>如果再继续被攻击到一定次数，敌机就会爆炸；</li>
<li>敌机被击爆之后，玩家会获取一定分数；</li>
<li>敌机的移动不需要玩家控制，而是以一定的随机速度向下移动；</li>
</ol>
</li>
<li>子弹：

<ol>
<li>只有英雄会发射子弹；</li>
<li>子弹遇到敌机后会攻击敌机；</li>
<li>同时子弹本身会消失；</li>
</ol>
</li>
<li>降落伞：

<ol>
<li>降落伞和英雄碰撞后，降落伞闪烁几次后消失；</li>
<li>同时玩家可以获得降落伞携带的道具，如双倍子弹、炸弹；</li>
</ol>
</li>
</ul>


<h4>从上面的描述中，我们至少可以抽象出两个基本概率：</h4>

<ol>
<li>类似英雄、敌机、子弹等有生命、有攻击力、可以移动等特性的物体，我们可以抽象成游戏中的<code>角色</code>；</li>
<li><p>游戏角色在不同时刻有不同<code>状态</code>，在<code>不同状态下有不同行为</code>。比如敌机可以在受到攻击后，可以加快速度冲向英雄，也可以处于闪烁状态，预示飞机即将爆炸；进一步对状态分析后发现，可以抽象出如下几种状态：</p>

<ul>
<li>正常状态：未受到攻击或只是轻微受伤，角色可以正常移动，攻击（对英雄），冲撞对方等；</li>
<li>被攻击状态：角色受到一定攻击，角色移动速度可能加快，或者带闪烁效果等；</li>
<li>爆炸状态：此时角色已经被消灭，但还未从屏幕中消失，正在爆炸过程中，此时角色已经没有攻击力，也不能移动了；</li>
<li>销毁状态：角色完全爆炸完成会进入这个状态，或角色移动出了屏幕范围，如子弹、敌机移出了屏幕范围也相当于被销毁了，此时角色不会显示在屏幕上了，他的生命周期已经结束；</li>
</ul>
</li>
</ol>


<blockquote><p>角色在不同时刻处于不同的状态，而且状态是可以转化的，如正常飞行的飞机在受到轻微攻击时可能转换到被攻击状态，但受到较大伤害（如玩家投放炸弹）可能使飞机直接转换到爆炸状态；并不是每个角色都存在这四种状态，如小飞机没有被攻击状态，因为小飞机一但被攻击，会直接爆炸。</p></blockquote>

<p>通过这个分析，我们抽象出了<code>角色</code>和<code>状态</code>，下一步就是开始大致设计这个游戏模块了。</p>

<h3>五、模块划分与程序设计</h3>

<ul>
<li>首先，游戏资源的加载和管理以及精灵的绘制都与游戏逻辑没直接关系，可以单独设计一个模块；</li>
<li>另外角色的创建和回收设计成一个专门的模块，回收角色是为了避免不断的创建新对象，如子弹会源源不断的发射出去，我们不可能每发射一颗子弹就创建一个新对象，这将消耗大量的设备资源，对GC的压力非常大，所以需要回收被销毁的角色，如被消灭的敌机、子弹等，回收后下次需要"创建"新对象时，我们只需要对回收后的角色初始化后再利用。这个模块还可以控制角色的创建时机。例如用一个固定时间间隔创建新的子弹，或者在一个时间段内随机生成一架敌机等；</li>
<li>游戏逻辑模块控制角色移动，游戏道具、英雄武器切换、玩家分数、游戏暂停等等；</li>
</ul>


<p>这个简单的模块划分对接下来的编码实现是非常有帮助的。</p>
]]></content>
  </entry>
  
</feed>
